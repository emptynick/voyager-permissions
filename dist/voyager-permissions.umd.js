var Q=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var k=(o,n,e)=>n in o?Q(o,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[n]=e,V=(o,n)=>{for(var e in n||(n={}))Y.call(n,e)&&k(o,e,n[e]);if(w)for(var e of w(n))Z.call(n,e)&&k(o,e,n[e]);return o},E=(o,n)=>W(o,X(n));(function(o,n){typeof exports=="object"&&typeof module!="undefined"?n(require("axios"),require("debounce"),require("vue")):typeof define=="function"&&define.amd?define(["axios","debounce","vue"],n):(o=typeof globalThis!="undefined"?globalThis:o||self,n(o.axios,o.debounce,o.Vue))})(this,function(o,n,e){"use strict";function y(t){return t&&typeof t=="object"&&"default"in t?t:{default:t}}var a=y(o),g=y(n),b=(t,s)=>{for(const[d,h]of s)t[d]=h;return t};const N={data(){return{permissions:{data:[],last_page:1,current_page:1},roles:{data:[],last_page:1,current_page:1},users:{data:[],last_page:1,current_page:1},parameters:{per_page:5,permissions_query:"",roles_query:"",users_query:"",selected:{type:null,id:null}},loading:!1,assign_to:null,assign_ids:[],logging_enabled:!1,logs:[]}},computed:{assignPermissions(){return this.assign_to=="permissions"&&(this.parameters.selected.type=="user"||this.parameters.selected.type=="role")},assignRoles(){return this.assign_to=="roles"&&(this.parameters.selected.type=="user"||this.parameters.selected.type=="permission")},assignUsers(){return this.assign_to=="users"&&(this.parameters.selected.type=="role"||this.parameters.selected.type=="permission")},breads(){let t={};return Object.values(this.$store.breads).forEach(s=>{t[s.table]=this.translate(s.name_plural,!0)}),t["*"]="All",t},tables(){let t={};return this.$store.tables.forEach(s=>{t[s]=s}),t["*"]="All",t}},methods:{load(){this.loading=!0,a.default.post(this.route("voyager.voyager-permissions"),E(V({},this.getParameters()),{permissions_page:this.permissions.current_page,roles_page:this.roles.current_page,users_page:this.users.current_page})).then(t=>{this.permissions=t.data.permissions,this.roles=t.data.roles,this.users=t.data.users,this.logging_enabled=t.data.logging}).catch(()=>{}).then(()=>{this.loading=!1})},select(t,s){if(this.assignPermissions||this.assignRoles||this.assignUsers){this.assign_ids.includes(s)?this.assign_ids=this.assign_ids.removeAtIndex(this.assign_ids.indexOf(s)):this.assign_ids.push(s);return}this.parameters.selected.type==t&&this.parameters.selected.id==s?this.unselect():(this.parameters.selected.type=t,this.parameters.selected.id=s),t=="permission"?this.users.current_page=1:t=="role"?(this.permissions.current_page=1,this.users.current_page=1):t=="user"&&(this.permissions.current_page=1),g.default(()=>{this.load()},250)},unselect(){this.parameters.selected.type=null,this.parameters.selected.id=null},isSelected(t,s){return this.assignPermissions?t=="permission"&&this.assign_ids.includes(s):this.assignRoles?t=="role"&&this.assign_ids.includes(s):this.assignUsers?t=="user"&&this.assign_ids.includes(s):this.parameters.selected.type==t&&this.parameters.selected.id==s},assign(t){if(this.assign_to=t,this.assign_ids=[],this.assignPermissions?(this.permissions.current_page=1,this.parameters.permissions_query=""):this.assignRoles?(this.roles.current_page=1,this.parameters.roles_query=""):this.assignUsers&&(this.users.current_page=1,this.parameters.users_query=""),this.parameters.selected.type=="permission"){let s=this.permissions.data.where("id",this.parameters.selected.id).first();this.assignRoles?this.assign_ids=s.roles.pluck("id"):this.assignUsers&&(this.assign_ids=s.users.pluck("id"))}else if(this.parameters.selected.type=="role"){let s=this.roles.data.where("id",this.parameters.selected.id).first();this.assignPermissions?this.assign_ids=s.permissions.pluck("id"):this.assignUsers&&(this.assign_ids=s.users.pluck("id"))}else if(this.parameters.selected.type=="user"){let s=this.users.data.where("id",this.parameters.selected.id).first();this.assignPermissions?this.assign_ids=s.permissions.pluck("id"):this.assignRoles&&(this.assign_ids=s.roles.pluck("id"))}this.load()},cancelAssign(){this.assign_to=null,this.assign_ids=null,this.load()},saveAssign(){this.loading=!0,a.default.post(this.route("voyager.voyager-permissions-assign"),{selected_type:this.parameters.selected.type,selected_id:this.parameters.selected.id,assign_type:this.assign_to,assign_ids:this.assign_ids}).then(t=>{new this.$notification("Successfully saved!").timeout().color("green").show()}).catch(()=>{}).then(()=>{this.loading=!1,this.cancelAssign()})},savePermission(t){a.default.post(this.route("voyager.voyager-permissions.add-permission"),{name:t}).then(s=>{new this.$notification(`Permission with name "${t}" created!`).timeout().color("green").show(),this.load()})},addPermission(){new this.$notification("Enter the name of the new permission").timeout().addButton({key:!0,value:this.__("voyager::generic.save"),color:"accent"}).addButton({key:!1,value:this.__("voyager::generic.cancel"),color:"red"}).prompt().show().then(t=>{t!==!1&&t!==""&&this.savePermission(t)})},addPermissionBread(){new this.$notification("Please select the ability and the BREAD").timeout().select({browse:"Browse",read:"Read",edit:"Edit",add:"Add",delete:"Delete",restore:"Restore",force_delete:"Force delete","*":"All"}).select(this.breads).addButton({key:!0,value:this.__("voyager::generic.save"),color:"accent"}).addButton({key:!1,value:this.__("voyager::generic.cancel"),color:"red"}).confirm().show().then(t=>{t!==!1&&this.isArray(t)&&t.length==2&&this.savePermission(`${t[0]} bread ${t[1]}`)})},addPermissionBuilder(){new this.$notification("Please select the ability and the table").timeout().select({browse:"Browse",read:"Read",edit:"Edit",add:"Add",delete:"delete",restore:"restore",force_delete:"Force delete","*":"All"}).select(this.tables).addButton({key:!0,value:this.__("voyager::generic.save"),color:"accent"}).addButton({key:!1,value:this.__("voyager::generic.cancel"),color:"red"}).confirm().show().then(t=>{t!==!1&&this.isArray(t)&&t.length==2&&this.savePermission(`${t[0]} builder ${t[1]}`)})},addRole(){new this.$notification("Enter the name of the new role").timeout().addButton({key:!0,value:this.__("voyager::generic.save"),color:"accent"}).addButton({key:!1,value:this.__("voyager::generic.cancel"),color:"red"}).prompt().show().then(t=>{t!==!1&&t!==""&&a.default.post(this.route("voyager.voyager-permissions.add-role"),{name:t}).then(s=>{new this.$notification(`Role with name "${t}" created!`).timeout().color("green").show(),this.load()})})},toggleLogging(t){a.default.post(this.route("voyager.voyager-permissions.toggle-logging"),{enabled:t}).then(s=>{new this.$notification(t?"Logging was enabled!":"Logging was disabled!").timeout().color("green").show(),this.loadLogs(),this.logging_enabled=t})},loadLogs(t=!1){(this.logging_enabled||!t)&&a.default.post(this.route("voyager.voyager-permissions.get-logs")).then(s=>{this.logs=s.data})},clearLogs(){a.default.post(this.route("voyager.voyager-permissions.clear-logs")).then(t=>{this.logs=[]})},getParameters(){if(this.assignPermissions||this.assignRoles||this.assignUsers){let t=JSON.parse(JSON.stringify(this.parameters));return t.selected.type=null,t.selected.id=null,t}return this.parameters},remove(){let t="";this.parameters.selected.type=="permission"?t=this.permissions.data.where("id",this.parameters.selected.id).first().name:this.parameters.selected.type=="role"&&(t=this.roles.data.where("id",this.parameters.selected.id).first().name),new this.$notification(`Are you sure you want to delete ${this.parameters.selected.type} "${t}"?`).color("red").timeout().confirm().show().then(s=>{s==!0&&a.default.post(this.route("voyager.voyager-permissions.remove"),this.parameters.selected).then(d=>{new this.$notification(`Deleted ${this.parameters.selected.type} "${t}"!`).timeout().color("green").show(),this.parameters.selected.type=null,this.parameters.selected.id=null,this.load()})})},permissionDescription(t){if(t=="browse permissions")return"Access the permission manager and show permissions";if(t=="add permissions")return"Add new permissions into the database";if(t=="delete permissions")return"Delete permissions from the database";if(t=="assign permissions to roles")return"Assign permissions to roles";if(t=="assign permissions to users")return"Assign permissions to users";if(t=="browse permission-roles")return"Show roles in the permission manager";if(t=="add permission-roles")return"Add new roles into the database";if(t=="delete permission-roles")return"Delete roles from the database";if(t=="assign roles to users")return"Assign roles to users";if(t=="browse permission-users")return"Show users in the permission manager";if(t=="browse voyager")return"Open and access Voyager";let s=t.split(" ");if(s[2]!=="*"){let d=Object.values(this.$store.breads).where("table",s[2]).first();d?s[2]=`BREAD <code>${this.translate(d.name_plural,!0)}</code>`:s[2]=`table <code>${s[2]}</code>`}return s.length==3&&s[1]=="bread"?s[0]=="*"&&s[2]=="*"?"Allows all actions on all BREADs":s[0]=="*"?`Allows all actions on ${s[2]}`:s[2]=="*"?`Allows to ${s[0]} all BREADs`:`Allows to ${s[0]} ${s[2]}`:s.length==3&&s[1]=="builder"?s[0]=="*"&&s[2]=="*"?"Allows all actions on all BREADs in the builder":s[0]=="*"?`Allows all actions in the builder for ${s[2]}`:s[2]=="*"?`Allows to ${s[0]} all BREADs in the builder`:`Allows to ${s[0]} ${s[2]} in the builder`:"Custom permission"}},mounted(){this.$watch(()=>this.users.current_page+this.permissions.current_page,g.default(()=>{this.load()},250)),this.$watch(()=>this.parameters.per_page,g.default(()=>{this.load()},250)),this.$watch(()=>this.parameters.permissions_query,g.default(()=>{this.permissions.current_page=1,this.load()},250)),this.$watch(()=>this.parameters.users_query,g.default(()=>{this.users.current_page=1,this.load()},250)),this.$watch(()=>this.parameters.selected,g.default(()=>{this.load()},250),{deep:!0}),this.load(),setInterval(()=>{this.loadLogs(!0)},5e3),this.loadLogs()}},C={class:"card"},A={class:"flex"},B={key:0,class:"mb-2 text-center text-xl"},x=["innerHTML"],D={class:"flex w-full space-x-1"},S=e.createElementVNode("span",null,"Add",-1),P=e.createElementVNode("span",null,"BREAD",-1),R=e.createElementVNode("span",null,"Builder",-1),U={key:0,class:"mb-2 text-center text-xl"},L=e.createElementVNode("span",null,"Add",-1),q={key:0,class:"mb-2 text-center text-xl"},T={key:0,class:"text-center"},z=e.createTextVNode(" Logging is currently disabled. Click "),I=e.createTextVNode(" to enable it. "),M={class:"voyager-table"},j=e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[e.createElementVNode("th",null,"Type"),e.createElementVNode("th",null,"Action"),e.createElementVNode("th",null,"Guard"),e.createElementVNode("th",null,"Requests"),e.createElementVNode("th",null,"Last request")])],-1);function F(t,s,d,h,l,r){const c=e.resolveComponent("Card"),p=e.resolveComponent("Icon"),u=e.resolveComponent("Pagination"),f=e.resolveDirective("tooltip");return e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("div",C,[e.createElementVNode("div",A,[e.createVNode(c,{class:e.normalizeClass(["w-full md:w-1/3",r.assignRoles||r.assignUsers?"opacity-50":null]),title:`Permissions (${l.permissions.total||0})`},e.createSlots({default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("input",{type:"text",class:"input small w-full mb-3","onUpdate:modelValue":s[0]||(s[0]=i=>l.parameters.permissions_query=i),placeholder:"Search permissions"},null,512),[[e.vModelText,l.parameters.permissions_query]]),l.permissions.data.length==0||l.loading?(e.openBlock(),e.createElementBlock("div",B,e.toDisplayString(l.loading?"Loading permissions":"No permissions match your queries"),1)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.permissions.data,(i,m)=>(e.openBlock(),e.createBlock(c,{class:e.normalizeClass(["cursor-pointer",r.isSelected("permission",i.id)?"border-accent-500":null]),key:`permission-${m}`,title:i.name,titleSize:6,onClick:_=>r.select("permission",i.id)},{default:e.withCtx(()=>[e.createElementVNode("p",{innerHTML:r.permissionDescription(i.name)},null,8,x),e.createElementVNode("small",null,"Assigned to "+e.toDisplayString(i.users.length)+" users and "+e.toDisplayString(i.roles.length)+" roles.",1)]),_:2},1032,["title","class","onClick"]))),128)),e.createElementVNode("div",D,[e.withDirectives(e.createElementVNode("button",{class:"button green justify-center w-full mb-2",onClick:s[1]||(s[1]=(...i)=>r.addPermission&&r.addPermission(...i))},[e.createVNode(p,{icon:"plus"}),S],512),[[f,"Add a new permission"]]),e.withDirectives(e.createElementVNode("button",{class:"button green justify-center w-full mb-2",onClick:s[2]||(s[2]=(...i)=>r.addPermissionBread&&r.addPermissionBread(...i))},[e.createVNode(p,{icon:"plus"}),P],512),[[f,"Add a new permission for a BREAD"]]),e.withDirectives(e.createElementVNode("button",{class:"button green justify-center w-full mb-2",onClick:s[3]||(s[3]=(...i)=>r.addPermissionBuilder&&r.addPermissionBuilder(...i))},[e.createVNode(p,{icon:"plus"}),R],512),[[f,"Add a new permission for the BREAD builder"]])]),e.createVNode(u,{modelValue:l.permissions.current_page,"onUpdate:modelValue":s[4]||(s[4]=i=>l.permissions.current_page=i),pageCount:l.permissions.last_page},null,8,["modelValue","pageCount"])]),_:2},[l.parameters.selected.type=="permission"?{name:"actions",fn:e.withCtx(()=>[e.createElementVNode("button",{class:"button small red",onClick:s[5]||(s[5]=i=>r.remove())},"Delete"),e.createElementVNode("button",{class:"button small",onClick:s[6]||(s[6]=(...i)=>r.unselect&&r.unselect(...i))},"Unselect"),e.createElementVNode("button",{class:"button small",onClick:s[7]||(s[7]=i=>r.assign("users"))},"Users"),e.createElementVNode("button",{class:"button small",onClick:s[8]||(s[8]=i=>r.assign("roles"))},"Roles")])}:r.assignPermissions?{name:"actions",fn:e.withCtx(()=>[e.createElementVNode("button",{class:"button small green",onClick:s[9]||(s[9]=i=>r.saveAssign())},"Save ("+e.toDisplayString(this.assign_ids.length)+")",1),e.createElementVNode("button",{class:"button small red",onClick:s[10]||(s[10]=i=>r.cancelAssign())},"Cancel")])}:void 0]),1032,["class","title"]),e.createVNode(c,{class:e.normalizeClass(["w-full md:w-1/3",r.assignPermissions||r.assignUsers?"opacity-50":null]),title:`Roles (${l.roles.total||0})`},e.createSlots({default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("input",{type:"text",class:"input small w-full mb-3","onUpdate:modelValue":s[11]||(s[11]=i=>l.parameters.roles_query=i),placeholder:"Search roles"},null,512),[[e.vModelText,l.parameters.roles_query]]),l.roles.data.length==0||l.loading?(e.openBlock(),e.createElementBlock("div",U,e.toDisplayString(l.loading?"Loading roles":"No roles match your queries"),1)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.roles.data,(i,m)=>(e.openBlock(),e.createBlock(c,{class:e.normalizeClass(["cursor-pointer",r.isSelected("role",i.id)?"border-accent-500":null]),key:`role-${m}`,title:i.name,titleSize:6,onClick:_=>r.select("role",i.id)},{default:e.withCtx(()=>[e.createTextVNode(" Assigned to "+e.toDisplayString(i.users.length)+" users. Has "+e.toDisplayString(i.permissions.length)+" permissions ",1)]),_:2},1032,["title","class","onClick"]))),128)),e.createElementVNode("button",{class:"button green justify-center w-full mb-2",onClick:s[12]||(s[12]=(...i)=>r.addRole&&r.addRole(...i))},[e.createVNode(p,{icon:"plus"}),L]),e.createVNode(u,{modelValue:l.roles.current_page,"onUpdate:modelValue":s[13]||(s[13]=i=>l.roles.current_page=i),pageCount:l.roles.last_page},null,8,["modelValue","pageCount"])]),_:2},[l.parameters.selected.type=="role"?{name:"actions",fn:e.withCtx(()=>[e.createElementVNode("button",{class:"button small red",onClick:s[14]||(s[14]=i=>r.remove())},"Delete"),e.createElementVNode("button",{class:"button small",onClick:s[15]||(s[15]=(...i)=>r.unselect&&r.unselect(...i))},"Unselect"),e.createElementVNode("button",{class:"button small",onClick:s[16]||(s[16]=i=>r.assign("permissions"))},"Permissions"),e.createElementVNode("button",{class:"button small",onClick:s[17]||(s[17]=i=>r.assign("users"))},"Users")])}:r.assignRoles?{name:"actions",fn:e.withCtx(()=>[e.createElementVNode("button",{class:"button small green",onClick:s[18]||(s[18]=i=>r.saveAssign())},"Save ("+e.toDisplayString(this.assign_ids.length)+")",1),e.createElementVNode("button",{class:"button small red",onClick:s[19]||(s[19]=i=>r.cancelAssign())},"Cancel")])}:void 0]),1032,["class","title"]),e.createVNode(c,{class:e.normalizeClass(["w-full md:w-1/3",r.assignRoles||r.assignPermissions?"opacity-50":null]),title:`Users (${l.users.total||0})`},e.createSlots({default:e.withCtx(()=>[e.withDirectives(e.createElementVNode("input",{type:"text",class:"input small w-full mb-3","onUpdate:modelValue":s[20]||(s[20]=i=>l.parameters.users_query=i),placeholder:"Search users"},null,512),[[e.vModelText,l.parameters.users_query]]),l.users.data.length==0||l.loading?(e.openBlock(),e.createElementBlock("div",q,e.toDisplayString(l.loading?"Loading users":"No users match your queries"),1)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.users.data,(i,m)=>(e.openBlock(),e.createBlock(c,{class:e.normalizeClass(["cursor-pointer",r.isSelected("user",i.id)?"border-accent-500":null]),key:`user-${m}`,title:i.name,titleSize:6,onClick:_=>r.select("user",i.id)},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(i.permissions.length)+" permissions ",1)]),_:2},1032,["title","onClick","class"]))),128)),e.createVNode(u,{modelValue:l.users.current_page,"onUpdate:modelValue":s[21]||(s[21]=i=>l.users.current_page=i),pageCount:l.users.last_page},null,8,["modelValue","pageCount"])]),_:2},[l.parameters.selected.type=="user"?{name:"actions",fn:e.withCtx(()=>[e.createElementVNode("button",{class:"button small",onClick:s[22]||(s[22]=(...i)=>r.unselect&&r.unselect(...i))},"Unselect"),e.createElementVNode("button",{class:"button small",onClick:s[23]||(s[23]=i=>r.assign("permissions"))},"Assign permissions"),e.createElementVNode("button",{class:"button small",onClick:s[24]||(s[24]=i=>r.assign("roles"))},"Assign roles")])}:r.assignUsers?{name:"actions",fn:e.withCtx(()=>[e.createElementVNode("button",{class:"button small green",onClick:s[25]||(s[25]=i=>r.saveAssign())},"Save ("+e.toDisplayString(this.assign_ids.length)+")",1),e.createElementVNode("button",{class:"button small red",onClick:s[26]||(s[26]=i=>r.cancelAssign())},"Cancel")])}:void 0]),1032,["class","title"])])]),e.createVNode(c,{title:"Logging"},e.createSlots({default:e.withCtx(()=>[l.logging_enabled?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",T,[z,e.createElementVNode("a",{href:"#",onClick:s[27]||(s[27]=e.withModifiers(i=>r.toggleLogging(!0),["prevent"]))},"here"),I])),e.createElementVNode("div",M,[e.createElementVNode("table",null,[j,e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.logs,(i,m)=>(e.openBlock(),e.createElementBlock("tr",{key:`log-${m}`},[e.createElementVNode("td",null,e.toDisplayString(i.type),1),e.createElementVNode("td",null,e.toDisplayString(i.action),1),e.createElementVNode("td",null,e.toDisplayString(i.guard||"None"),1),e.createElementVNode("td",null,e.toDisplayString(i.count),1),e.createElementVNode("td",null,e.toDisplayString(i.time),1)]))),128))])])])]),_:2},[l.logging_enabled?{name:"actions",fn:e.withCtx(()=>[e.createElementVNode("button",{class:"button blue",onClick:s[28]||(s[28]=i=>r.toggleLogging(!1))},"Disable logging"),e.createElementVNode("button",{class:"button blue",onClick:s[29]||(s[29]=i=>r.clearLogs())},"Clear logs")])}:void 0]),1024)])}var H=b(N,[["render",F]]);const O={},J=[e.createStaticVNode("<p>Thanks for installing Voyager permissions.</p><p>Run the installer by calling <code>php artisan permissions:install</code>.</p><p>First the installer will publish a configuration file and migrations.</p><p>After that you will be asked if you want to migrate now.</p><p>If you want to change the published migrations select `No` and run the command again after you finished editing.</p><p>The the installer will ask you to open your user model and add the trait `Emptynick\\Permissions\\Traits\\HasRoles`:</p><code> &lt;?php<br><br> namespace App\\Models;<br><br> use Illuminate\\Foundation\\Auth\\User as Authenticatable;<br> use Emptynick\\Permissions\\Traits\\HasRoles;<br><br> class User extends Authenticatable<br> {<br> use HasRoles;<br><br> // ...<br> } </code><p>In order to be allowed to open the permission manager, the installer will add some required permissions to your user.</p><p>Enter your user model (normally <code>\\App\\Models\\User</code>) hit enter and enter the ID of your user.</p><p>Thats it! Now you are able to access the <code>Permission</code> page from the menu.</p>",10)];function G(t,s,d,h,l,r){return e.openBlock(),e.createElementBlock("div",null,J)}var K=b(O,[["render",G]]);voyager.component("voyager-permissions",H),voyager.component("voyager-permissions-instructions",K)});
